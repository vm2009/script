--
    - FIXED VERSION: Security, Memory Leaks, UI Dragging & Noclip Logic.
]] 

local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

-- ==============================================================================
-- ВСТРОЕННЫЙ МОДУЛЬ AIMBOT (EXUNYS V3)
-- ==============================================================================
local function LoadAimbotModule()
    --// Cache
    local game, workspace = game, workspace
    local getrawmetatable, getmetatable, setmetatable, pcall, getgenv, next, tick = getrawmetatable, getmetatable, setmetatable, pcall, getgenv, next, tick
    local Vector2new, Vector3zero, CFramenew, Color3fromRGB, Color3fromHSV, Drawingnew, TweenInfonew = Vector2.new, Vector3.zero, CFrame.new, Color3.fromRGB, Color3.fromHSV, Drawing.new, TweenInfo.new
    local getupvalue, mousemoverel, tablefind, tableremove, stringlower, stringsub, mathclamp = debug.getupvalue, mousemoverel or (Input and Input.MouseMove), table.find, table.remove, string.lower, string.sub, math.clamp

    local GameMetatable = getrawmetatable and getrawmetatable(game) or {
        __index = function(self, Index) return self end,
        __newindex = function(self, Index, Value) self = Value end
    }

    local __index = GameMetatable.__index
    local __newindex = GameMetatable.__newindex
    local getrenderproperty, setrenderproperty = getrenderproperty or __index, setrenderproperty or __newindex
    local GetService = __index(game, "GetService")

    --// Services
    local RunService = GetService(game, "RunService")
    local UserInputService = GetService(game, "UserInputService")
    local TweenService = GetService(game, "TweenService")
    local Players = GetService(game, "Players")

    --// Service Methods
    local LocalPlayer = __index(Players, "LocalPlayer")
    local Camera = __index(workspace, "CurrentCamera")
    local FindFirstChild, FindFirstChildOfClass = __index(game, "FindFirstChild"), __index(game, "FindFirstChildOfClass")
    local GetDescendants = __index(game, "GetDescendants")
    local WorldToViewportPoint = __index(Camera, "WorldToViewportPoint")
    local GetPartsObscuringTarget = __index(Camera, "GetPartsObscuringTarget")
    local GetMouseLocation = __index(UserInputService, "GetMouseLocation")
    local GetPlayers = __index(Players, "GetPlayers")

    --// Variables
    local RequiredDistance, Typing, Running, ServiceConnections, Animation, OriginalSensitivity = 2000, false, false, {}, nil, 1
    local Connect, Disconnect = __index(game, "DescendantAdded").Connect

    --// Checking for multiple processes
    if getgenv().ExunysDeveloperAimbot and getgenv().ExunysDeveloperAimbot.Exit then
        getgenv().ExunysDeveloperAimbot:Exit()
    end

    --// Environment
    getgenv().ExunysDeveloperAimbot = {
        DeveloperSettings = { UpdateMode = "RenderStepped", TeamCheckOption = "TeamColor", RainbowSpeed = 1 },
        Settings = {
            Enabled = false, 
            TeamCheck = false,
            AliveCheck = true,
            WallCheck = false,
            OffsetToMoveDirection = false,
            OffsetIncrement = 15,
            Sensitivity = 0.2,
            Sensitivity2 = 3.5,
            LockMode = 1,
            LockPart = "Head",
            TriggerKey = Enum.UserInputType.MouseButton2,
            Toggle = false
        },
        FOVSettings = {
            Enabled = true,
            Visible = false, 
            Radius = 90,
            NumSides = 60,
            Thickness = 1,
            Transparency = 1,
            Filled = false,
            RainbowColor = false,
            RainbowOutlineColor = false,
            Color = Color3fromRGB(255, 255, 255),
            OutlineColor = Color3fromRGB(0, 0, 0),
            LockedColor = Color3fromRGB(255, 150, 150)
        },
        Blacklisted = {},
        FOVCircleOutline = Drawingnew("Circle"),
        FOVCircle = Drawingnew("Circle")
    }

    local Environment = getgenv().ExunysDeveloperAimbot
    setrenderproperty(Environment.FOVCircle, "Visible", false)
    setrenderproperty(Environment.FOVCircleOutline, "Visible", false)

    --// Core Functions
    local ConvertVector = function(Vector) return Vector2new(Vector.X, Vector.Y) end

    local CancelLock = function()
        Environment.Locked = nil
        local FOVCircle = Environment.FOVCircle
        setrenderproperty(FOVCircle, "Color", Environment.FOVSettings.Color)
        __newindex(UserInputService, "MouseDeltaSensitivity", OriginalSensitivity)
        if Animation then Animation:Cancel() end
    end

    local GetClosestPlayer = function()
        local Settings = Environment.Settings
        local LockPart = Settings.LockPart
        if not Environment.Locked then
            RequiredDistance = Environment.FOVSettings.Enabled and Environment.FOVSettings.Radius or 2000
            for _, Value in next, GetPlayers(Players) do
                local Character = __index(Value, "Character")
                local Humanoid = Character and FindFirstChildOfClass(Character, "Humanoid")
                if Value ~= LocalPlayer and not table.find(Environment.Blacklisted, __index(Value, "Name")) and Character and FindFirstChild(Character, LockPart) and Humanoid then
                    local PartPosition = __index(Character, "Position")
                    if Settings.AliveCheck and __index(Humanoid, "Health") <= 0 then continue end
                    local Vector, OnScreen, Distance = WorldToViewportPoint(Camera, PartPosition)
                    Vector = ConvertVector(Vector)
                    Distance = (GetMouseLocation(UserInputService) - Vector).Magnitude
                    if Distance < RequiredDistance and OnScreen then
                        RequiredDistance, Environment.Locked = Distance, Value
                    end
                end
            end
        elseif (GetMouseLocation(UserInputService) - ConvertVector(WorldToViewportPoint(Camera, __index(__index(__index(Environment.Locked, "Character"), LockPart), "Position")))).Magnitude > RequiredDistance then
            CancelLock()
        end
    end

    local Load = function()
        OriginalSensitivity = __index(UserInputService, "MouseDeltaSensitivity")
        local Settings, FOVCircle, FOVCircleOutline, FOVSettings = Environment.Settings, Environment.FOVCircle, Environment.FOVCircleOutline, Environment.FOVSettings

        ServiceConnections.RenderSteppedConnection = Connect(__index(RunService, Environment.DeveloperSettings.UpdateMode), function()
            if FOVSettings.Enabled and Settings.Enabled and FOVSettings.Visible then
                setrenderproperty(FOVCircle, "Radius", FOVSettings.Radius)
                setrenderproperty(FOVCircleOutline, "Radius", FOVSettings.Radius)
                setrenderproperty(FOVCircle, "Position", GetMouseLocation(UserInputService))
                setrenderproperty(FOVCircleOutline, "Position", GetMouseLocation(UserInputService))
                setrenderproperty(FOVCircle, "Visible", true)
                setrenderproperty(FOVCircleOutline, "Visible", true)
            else
                setrenderproperty(FOVCircle, "Visible", false)
                setrenderproperty(FOVCircleOutline, "Visible", false)
            end

            if Running and Settings.Enabled then
                GetClosestPlayer()
                if Environment.Locked then
                    local LockedPosition_Vector3 = __index(__index(Environment.Locked, "Character"), "Position")
                    
                    if Settings.Sensitivity > 0 then
                        Animation = TweenService:Create(Camera, TweenInfonew(Settings.Sensitivity, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {CFrame = CFramenew(Camera.CFrame.Position, LockedPosition_Vector3)})
                        Animation:Play()
                    else
                        Camera.CFrame = CFramenew(Camera.CFrame.Position, LockedPosition_Vector3)
                    end
                    
                    setrenderproperty(FOVCircle, "Color", FOVSettings.LockedColor)
                end
            end
        end)

        ServiceConnections.InputBeganConnection = Connect(__index(UserInputService, "InputBegan"), function(Input)
            if Typing then return end
            if Input.UserInputType == Enum.UserInputType.Keyboard and Input.KeyCode == Settings.TriggerKey or Input.UserInputType == Settings.TriggerKey then
                Running = true
            end
        end)

        ServiceConnections.InputEndedConnection = Connect(__index(UserInputService, "InputEnded"), function(Input)
            if Typing then return end
            if Input.UserInputType == Enum.UserInputType.Keyboard and Input.KeyCode == Settings.TriggerKey or Input.UserInputType == Settings.TriggerKey then
                Running = false
                CancelLock()
            end
        end)
    end

    ServiceConnections.TypingStartedConnection = Connect(__index(UserInputService, "TextBoxFocused"), function() Typing = true end)
    ServiceConnections.TypingEndedConnection = Connect(__index(UserInputService, "TextBoxFocusReleased"), function() Typing = false end)

    function Environment.Exit(self)
        for Index, _ in next, ServiceConnections do
            Disconnect(ServiceConnections)
        end
        self.FOVCircle:Remove()
        self.FOVCircleOutline:Remove()
        getgenv().ExunysDeveloperAimbot = nil
    end

    Environment.Load = Load
    return Environment
end

local Aimbot = LoadAimbotModule()
Aimbot.Load()

-- ==============================================================================
-- ОСНОВНОЙ СКРИПТ ХАБА
-- ==============================================================================

-- --- ЛОКАЛЬНЫЕ ПЕРЕМЕННЫЕ И СОЕДИНЕНИЯ ---
local ClickTPEnabled = false
local ESPEnabled = false
local noclipConn = nil
local flyLoaded = false
local AppConnections = {} -- Хранилище всех ивентов для защиты от утечек памяти

-- --- ФУНКЦИЯ БЕЗОПАСНОЙ ЗАГРУЗКИ ---
local function SafeLoad(url)
    local success, result = pcall(function() return game:HttpGet(url) end)
    if not success then return nil end
    local func, err = loadstring(result)
    if not func then return nil end
    return func()
end

-- --- НАСТРОЙКИ ---
local isMobile = UserInputService.TouchEnabled
local scale = isMobile and 0.9 or 1
local Theme = {
    Bg = Color3.fromRGB(20, 20, 25),
    Element = Color3.fromRGB(35, 35, 40),
    Accent = Color3.fromRGB(0, 110, 255),
    Text = Color3.fromRGB(240, 240, 240),
    Corner = UDim.new(0, 9)
}

local function getExecutor()
    if identifyexecutor then return identifyexecutor() end
    if getexecutorname then return getexecutorname() end
    if fluxus then return "Fluxus" end
    if delta then return "Delta" end
    return "System"
end

-- --- GUI SETUP (Защита от античита) ---
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "YouthHub_UltPro"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local success, hiddenGui = pcall(function() return gethui() end)
ScreenGui.Parent = success and hiddenGui or CoreGui

-- ГЛАВНОЕ ОКНО
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 550 * scale, 0, 380 * scale)
MainFrame.Position = UDim2.new(0.5, -275 * scale, 0.5, -190 * scale)
MainFrame.BackgroundColor3 = Theme.Bg
MainFrame.BackgroundTransparency = 0.15
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Visible = true
MainFrame.Parent = ScreenGui

Instance.new("UICorner", MainFrame).CornerRadius = Theme.Corner
local MainStroke = Instance.new("UIStroke", MainFrame)
MainStroke.Color = Color3.fromRGB(60, 60, 70)
MainStroke.Thickness = 1
MainStroke.Transparency = 0.6

-- ПЛАВНОЕ ПЕРЕМЕЩЕНИЕ ОКНА (Custom Dragging)
local guiDragging, dragInput, dragStart, startPosGui
table.insert(AppConnections, MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        guiDragging = true
        dragStart = input.Position
        startPosGui = MainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then guiDragging = false end
        end)
    end
end))
table.insert(AppConnections, MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end))
table.insert(AppConnections, UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and guiDragging then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPosGui.X.Scale, startPosGui.X.Offset + delta.X, startPosGui.Y.Scale, startPosGui.Y.Offset + delta.Y)
    end
end))

-- ТОП БАР
local TopBar = Instance.new("Frame", MainFrame)
TopBar.Size = UDim2.new(1, 0, 0, 40 * scale)
TopBar.BackgroundColor3 = Theme.Element
TopBar.BackgroundTransparency = 0.5
TopBar.BorderSizePixel = 0
Instance.new("UICorner", TopBar).CornerRadius = Theme.Corner

local TopPatch = Instance.new("Frame", TopBar)
TopPatch.Size = UDim2.new(1, 0, 0, 10)
TopPatch.Position = UDim2.new(0, 0, 1, -10)
TopPatch.BackgroundColor3 = Theme.Element
TopPatch.BackgroundTransparency = 1
TopPatch.BorderSizePixel = 0

local Title = Instance.new("TextLabel", TopBar)
Title.Size = UDim2.new(0, 150, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "HUB"
Title.Font = Enum.Font.GothamBlack
Title.TextColor3 = Theme.Text
Title.TextSize = 18 * scale
Title.TextXAlignment = 0

local function mkWinBtn(txt, col, off)
    local b = Instance.new("TextButton", TopBar)
    b.Size = UDim2.new(0, 30 * scale, 0, 30 * scale)
    b.Position = UDim2.new(1, off * scale, 0.5, -15 * scale)
    b.BackgroundColor3 = col
    b.BackgroundTransparency = 0.2
    b.Text = txt
    b.TextColor3 = Color3.new(1,1,1)
    b.Font = Enum.Font.GothamBold
    b.TextSize = 14 * scale
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)
    return b
end

local CloseBtn = mkWinBtn("X", Color3.fromRGB(200, 50, 50), -40)
local MinBtn = mkWinBtn("-", Color3.fromRGB(220, 170, 40), -80)

-- МИНИ КНОПКА
local MiniButton = Instance.new("TextButton")
MiniButton.Size = UDim2.new(0, 50 * scale, 0, 50 * scale)
MiniButton.Position = UDim2.new(0.1, 0, 0.1, 0)
MiniButton.BackgroundColor3 = Theme.Bg
MiniButton.BackgroundTransparency = 0.2
MiniButton.Text = "H"
MiniButton.TextColor3 = Theme.Text
MiniButton.Font = Enum.Font.GothamBlack
MiniButton.TextSize = 24 * scale
MiniButton.Visible = false
MiniButton.Active = true
MiniButton.Parent = ScreenGui
Instance.new("UICorner", MiniButton).CornerRadius = UDim.new(0, 12)
Instance.new("UIStroke", MiniButton).Color = Theme.Accent

-- --- СИСТЕМА ВКЛАДОК ---
local SideBar = Instance.new("Frame", MainFrame)
SideBar.Size = UDim2.new(0, 140 * scale, 1, -40 * scale)
SideBar.Position = UDim2.new(0, 0, 0, 40 * scale)
SideBar.BackgroundTransparency = 1

local PageContainer = Instance.new("Frame", MainFrame)
PageContainer.Size = UDim2.new(1, -150 * scale, 1, -50 * scale)
PageContainer.Position = UDim2.new(0, 145 * scale, 0, 45 * scale)
PageContainer.BackgroundTransparency = 1

local tabs = {}
local function SwitchTab(name)
    for tName, data in pairs(tabs) do
        if tName == name then
            data.Frame.Visible = true
            data.Button.BackgroundColor3 = Theme.Accent
            data.Button.BackgroundTransparency = 0.1
            data.Button.TextColor3 = Color3.new(1,1,1)
        else
            data.Frame.Visible = false
            data.Button.BackgroundColor3 = Theme.Element
            data.Button.BackgroundTransparency = 0.8
            data.Button.TextColor3 = Color3.fromRGB(150, 150, 160)
        end
    end
end

local function CreateTab(txt, ord)
    local b = Instance.new("TextButton", SideBar)
    b.Size = UDim2.new(0.9, 0, 0, 40 * scale)
    b.Position = UDim2.new(0.05, 0, 0, 10 * scale + (ord * 45 * scale))
    b.Text = txt
    b.Font = Enum.Font.GothamBold
    b.TextSize = 13 * scale
    b.AutoButtonColor = false
    b.BackgroundColor3 = Theme.Element
    b.BackgroundTransparency = 0.8
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)

    local p = Instance.new("Frame", PageContainer)
    p.Size = UDim2.new(1,0,1,0)
    p.BackgroundTransparency = 1
    p.Visible = false
    tabs = {Button = b, Frame = p}
    
    b.MouseButton1Click:Connect(function() SwitchTab(txt) end)
    return p
end

-- ==========================================
-- TAB 1: MAIN
-- ==========================================
local P_Main = CreateTab("Main", 0)

local Av = Instance.new("ImageLabel", P_Main)
Av.Size = UDim2.new(0,100 * scale,0,100 * scale)
Av.Position = UDim2.new(0.5,-50 * scale,0.1,0)
Av.BackgroundTransparency = 1
Av.Image = "rbxthumb://type=AvatarHeadShot&id="..Player.UserId.."&w=420&h=420"
Instance.new("UICorner", Av).CornerRadius = UDim.new(1, 0)
Instance.new("UIStroke", Av).Color = Theme.Accent
Instance.new("UIStroke", Av).Thickness = 2
Instance.new("UIStroke", Av).Transparency = 0.3

local function mkLbl(txt, sz, pos, col, font)
    local l = Instance.new("TextLabel", P_Main)
    l.Text = txt
    l.TextSize = sz * scale
    l.Position = pos
    l.TextColor3 = col
    l.Font = font
    l.Size = UDim2.new(1,0,0,sz * 1.5 * scale)
    l.BackgroundTransparency = 1
    return l
end

mkLbl(Player.DisplayName, 20, UDim2.new(0,0,0.5,0), Theme.Text, Enum.Font.GothamBlack)
mkLbl("@"..Player.Name, 15, UDim2.new(0,0,0.6,0), Color3.fromRGB(150,150,150), Enum.Font.Gotham)

local ExecFrame = Instance.new("Frame", P_Main)
ExecFrame.Size = UDim2.new(0.6, 0, 0, 35 * scale)
ExecFrame.Position = UDim2.new(0.2, 0, 0.75, 0)
ExecFrame.BackgroundColor3 = Theme.Element
ExecFrame.BackgroundTransparency = 0.4
Instance.new("UICorner", ExecFrame).CornerRadius = UDim.new(0, 6)
Instance.new("UIStroke", ExecFrame).Color = Theme.Accent
Instance.new("UIStroke", ExecFrame).Transparency = 0.5
local ExecLbl = mkLbl(getExecutor(), 14, UDim2.new(0,0,0.15,0), Theme.Text, Enum.Font.GothamBold)
ExecLbl.Parent = ExecFrame

-- ==========================================
-- TAB 2: MENU (Scripts)
-- ==========================================
local P_Menu = CreateTab("Menu", 1)
local MenuList = Instance.new("Frame", P_Menu)
MenuList.Size = UDim2.new(1, -10 * scale, 1, -10 * scale)
MenuList.Position = UDim2.new(0, 5 * scale, 0, 5 * scale)
MenuList.BackgroundTransparency = 1
Instance.new("UIListLayout", MenuList).Padding = UDim.new(0, 8)

local function AddBtn(parent, txt, cb, tog)
    local f = Instance.new("Frame", parent)
    f.Size = UDim2.new(1, 0, 0, 42 * scale)
    f.BackgroundColor3 = Theme.Element
    f.BackgroundTransparency = 0.4
    Instance.new("UICorner", f).CornerRadius = UDim.new(0, 6)

    local l = Instance.new("TextLabel", f)
    l.Text = txt
    l.Size = UDim2.new(0.6,0,1,0)
    l.Position = UDim2.new(0,10,0,0)
    l.BackgroundTransparency = 1
    l.TextColor3 = Theme.Text
    l.TextXAlignment = 0
    l.Font = Enum.Font.GothamSemibold
    l.TextSize = 13 * scale

    local b = Instance.new("TextButton", f)
    b.Size = UDim2.new(0,70 * scale,0,30 * scale)
    b.Position = UDim2.new(1,-80 * scale,0.5,-15 * scale)
    b.Font = Enum.Font.GothamBold
    b.TextSize = 11 * scale
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)

    local st = false
    local function up()
        if tog then
            b.Text = st and "ON" or "OFF"
            b.BackgroundColor3 = st and Theme.Accent or Color3.fromRGB(50,50,60)
            b.BackgroundTransparency = st and 0.1 or 0.5
            b.TextColor3 = st and Color3.new(1,1,1) or Color3.new(0.7,0.7,0.7)
        else
            b.Text = "RUN"
            b.BackgroundColor3 = Theme.Accent
            b.BackgroundTransparency = 0.1
        end
    end
    up()

    b.MouseButton1Click:Connect(function()
        if tog then st = not st end
        up()
        cb(st)
    end)
    return {
        toggle = function() if tog then st = not st end up() cb(st) end
    }
end

-- ЛОГИКА С РАБОЧИМ NOCLIP И ПРАВИЛЬНЫМ ТОГГЛОМ
local function toggleFlyLogic(state)
    if state and not flyLoaded then
        SafeLoad("https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt")
        flyLoaded = true
    end
    local g = Player.PlayerGui:FindFirstChild("FlyGui") or Player.PlayerGui:FindFirstChild("main")
    if g then g.Enabled = state end
end

local function toggleNoclipLogic(state)
    if state then
        noclipConn = RunService.Stepped:Connect(function()
            if Player.Character then
                for _, v in pairs(Player.Character:GetDescendants()) do
                    if v:IsA("BasePart") and v.CanCollide then
                        v.CanCollide = false
                    end
                end
            end
        end)
        table.insert(AppConnections, noclipConn)
    else
        if noclipConn then
            noclipConn:Disconnect()
            noclipConn = nil
        end
    end
end

local FlyBtn = AddBtn(MenuList, "Fly GUI (F1)", toggleFlyLogic, true)
local JumpBtn = AddBtn(MenuList, "Infinite Jump (F2)", function() SafeLoad("https://obj.wearedevs.net/2/scripts/Infinite%20Jump.lua") end, true) 
local TpBtn = AddBtn(MenuList, "Ctrl+Click TP (F3)", function(s) ClickTPEnabled = s end, true)
local NcBtn = AddBtn(MenuList, "Noclip (F4)", toggleNoclipLogic, true)
AddBtn(MenuList, "Script #001 (F5)", function() SafeLoad("https://raw.githubusercontent.com/vm2009/script/refs/heads/main/SCRIPT%23001") end, false)
AddBtn(MenuList, "Infinite Yield (F6)", function() SafeLoad("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source") end, false)

-- Хоткеи с защитой от утечек
table.insert(AppConnections, UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.F1 then FlyBtn.toggle()
    elseif input.KeyCode == Enum.KeyCode.F2 then JumpBtn.toggle() 
    elseif input.KeyCode == Enum.KeyCode.F3 then TpBtn.toggle()
    elseif input.KeyCode == Enum.KeyCode.F4 then NcBtn.toggle()
    elseif input.KeyCode == Enum.KeyCode.F5 then SafeLoad("https://raw.githubusercontent.com/vm2009/script/refs/heads/main/SCRIPT%23001")
    elseif input.KeyCode == Enum.KeyCode.F6 then SafeLoad("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source")
    elseif input.KeyCode == Enum.KeyCode.RightControl then ToggleUI(not MainFrame.Visible)
    end
end))

table.insert(AppConnections, UserInputService.InputBegan:Connect(function(i,g)
    if not g and ClickTPEnabled and i.UserInputType == Enum.UserInputType.MouseButton1 then
        if (isMobile or UserInputService:IsKeyDown(Enum.KeyCode.LeftControl)) then
            if Player.Character then Player.Character:MoveTo(Mouse.Hit.p) end
        end
    end
end))

-- ==========================================
-- TAB 3: TELEPORTER (Coords)
-- ==========================================
local P_TP = CreateTab("Teleporter", 2) 
local TPData = {saved={}, recent={}}
local FNAME = "GlassHub_Ult.json"

pcall(function()
    if isfile(FNAME) then TPData = HttpService:JSONDecode(readfile(FNAME)) end
end)

local function saveD()
    if writefile then writefile(FNAME, HttpService:JSONEncode(TPData)) end
end

local SubTabs = Instance.new("Frame", P_TP)
SubTabs.Size = UDim2.new(1,0,0,35 * scale)
SubTabs.BackgroundTransparency = 1

local V_In = Instance.new("Frame", P_TP)
V_In.Size = UDim2.new(1,0,1,-40 * scale)
V_In.Position = UDim2.new(0,0,0,40 * scale)
V_In.BackgroundTransparency = 1

local V_Rec = Instance.new("ScrollingFrame", P_TP)
V_Rec.Size = UDim2.new(1,0,1,-40 * scale)
V_Rec.Position = UDim2.new(0,0,0,40 * scale)
V_Rec.BackgroundTransparency = 1
V_Rec.Visible = false
V_Rec.AutomaticCanvasSize = "Y"
V_Rec.ScrollBarThickness = 3

local V_Sav = Instance.new("ScrollingFrame", P_TP)
V_Sav.Size = UDim2.new(1,0,1,-40 * scale)
V_Sav.Position = UDim2.new(0,0,0,40 * scale)
V_Sav.BackgroundTransparency = 1
V_Sav.Visible = false
V_Sav.AutomaticCanvasSize = "Y"
V_Sav.ScrollBarThickness = 3

local function SetSub(n)
    V_In.Visible = (n==1)
    V_Rec.Visible = (n==2)
    V_Sav.Visible = (n==3)
end

local function mkSub(t, p, id)
    local b = Instance.new("TextButton", SubTabs)
    b.Size = UDim2.new(0.32,0,1,0)
    b.Position = UDim2.new(p,0,0,0)
    b.Text = t
    b.BackgroundColor3 = Theme.Element
    b.BackgroundTransparency = 0.4
    b.TextColor3 = Color3.new(1,1,1)
    b.Font = Enum.Font.GothamBold
    b.TextSize = 12 * scale
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)
    b.MouseButton1Click:Connect(function() SetSub(id) end)
end

mkSub("INPUT",0,1); mkSub("RECENT",0.34,2); mkSub("SAVED",0.68,3)

local function mkIn(ph,p)
    local t = Instance.new("TextBox", V_In)
    t.Size = UDim2.new(0.32,0,0,50 * scale)
    t.Position = UDim2.new(p,0,0,15)
    t.BackgroundColor3 = Theme.Element
    t.BackgroundTransparency = 0.4
    t.PlaceholderText = ph
    t.Text = ""
    t.TextColor3 = Color3.new(1,1,1)
    t.Font = Enum.Font.GothamBold
    t.TextSize = 18 * scale
    Instance.new("UICorner", t).CornerRadius = UDim.new(0, 6)
    return t
end

local iX, iY, iZ = mkIn("X",0), mkIn("Y",0.34), mkIn("Z",0.68)

local bTP = Instance.new("TextButton", V_In)
bTP.Size = UDim2.new(1,0,0,50 * scale)
bTP.Position = UDim2.new(0,0,0,80 * scale)
bTP.Text = "TELEPORT"
bTP.BackgroundColor3 = Theme.Accent
bTP.BackgroundTransparency = 0.1
bTP.TextColor3 = Color3.new(1,1,1)
bTP.Font = Enum.Font.GothamBlack
bTP.TextSize = 15 * scale
Instance.new("UICorner", bTP).CornerRadius = UDim.new(0, 6)

local bSv = Instance.new("TextButton", V_In)
bSv.Size = UDim2.new(1,0,0,50 * scale)
bSv.Position = UDim2.new(0,0,0,140 * scale)
bSv.Text = "SAVE POS"
bSv.BackgroundColor3 = Color3.fromRGB(200,80,120)
bSv.BackgroundTransparency = 0.1
bSv.TextColor3 = Color3.new(1,1,1)
bSv.Font = Enum.Font.GothamBlack
bSv.TextSize = 15 * scale
Instance.new("UICorner", bSv).CornerRadius = UDim.new(0, 6)

local function upL()
    for _,v in pairs(V_Rec:GetChildren()) do if v:IsA("Frame") then v:Destroy() end end
    for _,v in pairs(V_Sav:GetChildren()) do if v:IsA("Frame") then v:Destroy() end end
    Instance.new("UIListLayout", V_Rec).Padding = UDim.new(0,6)
    Instance.new("UIListLayout", V_Sav).Padding = UDim.new(0,6)

    local function draw(list, item, i, isSaved)
        local f = Instance.new("Frame", list)
        f.Size = UDim2.new(1,0,0,50 * scale)
        f.BackgroundColor3 = Theme.Element
        f.BackgroundTransparency = 0.4
        Instance.new("UICorner", f).CornerRadius = UDim.new(0,6)

        local l = Instance.new("TextLabel", f)
        l.Text = item.name
        l.Size = UDim2.new(0.5,0,1,0)
        l.Position = UDim2.new(0.03,0,0,0)
        l.BackgroundTransparency = 1
        l.TextColor3 = Color3.new(1,1,1)
        l.TextXAlignment = 0
        l.Font = Enum.Font.GothamSemibold
        l.TextSize = 13 * scale

        local go = Instance.new("TextButton", f)
        go.Size = UDim2.new(0,50 * scale,0,34 * scale)
        go.Position = UDim2.new(0.58,0,0.5,-17 * scale)
        go.Text = "TP"
        go.BackgroundColor3 = Theme.Accent
        go.TextColor3 = Color3.new(1,1,1)
        Instance.new("UICorner", go).CornerRadius = UDim.new(0,5)

        local del = Instance.new("TextButton", f)
        del.Size = UDim2.new(0,35 * scale,0,34 * scale)
        del.Position = UDim2.new(1,-40 * scale,0.5,-17 * scale)
        del.Text = "X"
        del.BackgroundColor3 = Color3.fromRGB(200,60,60)
        del.TextColor3 = Color3.new(1,1,1)
        Instance.new("UICorner", del).CornerRadius = UDim.new(0,5)

        if not isSaved then
            local add = Instance.new("TextButton", f)
            add.Size = UDim2.new(0,35 * scale,0,34 * scale)
            add.Position = UDim2.new(0.58,55 * scale,0.5,-17 * scale)
            add.Text = "+"
            add.BackgroundColor3 = Color3.fromRGB(80,200,80)
            add.TextColor3 = Color3.new(1,1,1)
            Instance.new("UICorner", add).CornerRadius = UDim.new(0,5)
            add.MouseButton1Click:Connect(function()
                table.insert(TPData.saved, item); saveD(); upL()
            end)
        end

        go.MouseButton1Click:Connect(function()
            if Player.Character then Player.Character:MoveTo(Vector3.new(item.x,item.y,item.z)) end
        end)
        del.MouseButton1Click:Connect(function()
            table.remove(isSaved and TPData.saved or TPData.recent, i); saveD(); upL()
        end)
    end

    for i,v in pairs(TPData.recent) do draw(V_Rec, v, i, false) end
    for i,v in pairs(TPData.saved) do draw(V_Sav, v, i, true) end
end

local function isDuplicate(pos)
    if #TPData.recent == 0 then return false end
    local last = TPData.recent
    local dist = (Vector3.new(last.x, last.y, last.z) - pos).Magnitude
    return dist < 1
end

bTP.MouseButton1Click:Connect(function()
    local x,y,z = tonumber(iX.Text), tonumber(iY.Text), tonumber(iZ.Text)
    if x and y and z then
        if Player.Character then Player.Character:MoveTo(Vector3.new(x,y,z)) end
        if not isDuplicate(Vector3.new(x,y,z)) then
            table.insert(TPData.recent, 1, {name="X:"..math.floor(x).." Z:"..math.floor(z), x=x,y=y,z=z})
            if #TPData.recent>15 then table.remove(TPData.recent) end
            saveD(); upL()
        end
    end
end)

bSv.MouseButton1Click:Connect(function()
    if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        local p = Player.Character.HumanoidRootPart.Position
        iX.Text = tostring(math.floor(p.X))
        iY.Text = tostring(math.floor(p.Y))
        iZ.Text = tostring(math.floor(p.Z))

        if not isDuplicate(p) then
            table.insert(TPData.recent, 1, {name="Saved: "..math.floor(p.X).." "..math.floor(p.Z), x=p.X,y=p.Y,z=p.Z})
            if #TPData.recent>15 then table.remove(TPData.recent) end
            saveD(); upL()
        end
    end
end)
upL()

-- ==========================================
-- TAB 4: TP PLAYER
-- ==========================================
local P_PlrTP = CreateTab("TP Player", 3)

local RefreshBtn = Instance.new("TextButton", P_PlrTP)
RefreshBtn.Size = UDim2.new(1, -20, 0, 30)
RefreshBtn.Position = UDim2.new(0, 10, 0, 5)
RefreshBtn.BackgroundColor3 = Theme.Accent
RefreshBtn.Text = "REFRESH LIST"
RefreshBtn.TextColor3 = Color3.new(1,1,1)
RefreshBtn.Font = Enum.Font.GothamBold
RefreshBtn.TextSize = 14
Instance.new("UICorner", RefreshBtn).CornerRadius = UDim.new(0,6)

local PlrList = Instance.new("ScrollingFrame", P_PlrTP)
PlrList.Size = UDim2.new(1, -10, 1, -50)
PlrList.Position = UDim2.new(0, 5, 0, 45)
PlrList.BackgroundTransparency = 1
PlrList.ScrollBarThickness = 4
Instance.new("UIListLayout", PlrList).Padding = UDim.new(0, 5)

local function UpdatePlayerList()
    for _,v in pairs(PlrList:GetChildren()) do if v:IsA("Frame") then v:Destroy() end end
    
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= Player then
            local f = Instance.new("Frame", PlrList)
            f.Size = UDim2.new(1, -10, 0, 50)
            f.BackgroundColor3 = Theme.Element
            f.BackgroundTransparency = 0.3
            Instance.new("UICorner", f).CornerRadius = UDim.new(0, 6)
            
            local icon = Instance.new("ImageLabel", f)
            icon.Size = UDim2.new(0, 40, 0, 40)
            icon.Position = UDim2.new(0, 5, 0, 5)
            icon.BackgroundTransparency = 1
            icon.Image = "rbxthumb://type=AvatarHeadShot&id="..p.UserId.."&w=150&h=150"
            Instance.new("UICorner", icon).CornerRadius = UDim.new(1,0)
            
            local dn = Instance.new("TextLabel", f)
            dn.Size = UDim2.new(0, 150, 0, 20)
            dn.Position = UDim2.new(0, 55, 0, 5)
            dn.BackgroundTransparency = 1
            dn.Text = p.DisplayName
            dn.TextColor3 = Color3.new(1,1,1)
            dn.TextXAlignment = 0
            dn.Font = Enum.Font.GothamBold
            dn.TextSize = 14
            
            local un = Instance.new("TextLabel", f)
            un.Size = UDim2.new(0, 150, 0, 20)
            un.Position = UDim2.new(0, 55, 0, 25)
            un.BackgroundTransparency = 1
            un.Text = "@"..p.Name
            un.TextColor3 = Color3.fromRGB(180,180,180)
            un.TextXAlignment = 0
            un.Font = Enum.Font.Gotham
            un.TextSize = 12
            
            local b = Instance.new("TextButton", f)
            b.Size = UDim2.new(0, 60, 0, 30)
            b.Position = UDim2.new(1, -70, 0.5, -15)
            b.BackgroundColor3 = Theme.Accent
            b.Text = "TP"
            b.TextColor3 = Color3.new(1,1,1)
            b.Font = Enum.Font.GothamBold
            Instance.new("UICorner", b).CornerRadius = UDim.new(0,6)
            
            b.MouseButton1Click:Connect(function()
                if Player.Character and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                    Player.Character:MoveTo(p.Character.HumanoidRootPart.Position)
                end
            end)
        end
    end
end
RefreshBtn.MouseButton1Click:Connect(UpdatePlayerList)
UpdatePlayerList()

-- ==========================================
-- TAB 5: VISUALS (ESP & AIM)
-- ==========================================
local P_Visuals = CreateTab("Visuals", 4) 
local VisList = Instance.new("Frame", P_Visuals)
VisList.Size = UDim2.new(1, -10, 1, -10)
VisList.Position = UDim2.new(0, 5, 0, 5)
VisList.BackgroundTransparency = 1
Instance.new("UIListLayout", VisList).Padding = UDim.new(0, 8)

local espFolder = Instance.new("Folder", CoreGui)
espFolder.Name = "YouthHub_ESP"

local function ClearESP()
    ESPEnabled = false
    espFolder:ClearAllChildren()
end

local function CreateHighlight(targetModel)
    if targetModel == Player.Character then return end
    if espFolder:FindFirstChild(targetModel.Name) then return end

    local h = Instance.new("Highlight")
    h.Name = targetModel.Name
    h.Adornee = targetModel
    h.FillColor = Color3.fromRGB(255, 0, 0)
    h.OutlineColor = Color3.fromRGB(255, 255, 255)
    h.FillTransparency = 0.5
    h.OutlineTransparency = 0
    h.Parent = espFolder
    
    targetModel.AncestryChanged:Connect(function(_, parent)
        if not parent then h:Destroy() end
    end)
end

local function toggleESP(state)
    ESPEnabled = state
    if state then
        for _, p in pairs(Players:GetPlayers()) do
            if p.Character then CreateHighlight(p.Character) end
        end
        
        task.spawn(function()
            while ESPEnabled do
                for _, p in pairs(Players:GetPlayers()) do
                    if p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                        CreateHighlight(p.Character)
                    end
                end
                task.wait(1)
            end
        end)
    else
        ClearESP()
    end
end

AddBtn(VisList, "ESP (Toggle)", function(state) toggleESP(state) end, true)

-- ------------------------------
-- AIMBOT SECTION (Exunys V3)
-- ------------------------------
local AimFrame = Instance.new("Frame", VisList)
AimFrame.Size = UDim2.new(1, 0, 0, 140)
AimFrame.BackgroundColor3 = Theme.Element
AimFrame.BackgroundTransparency = 0.4
Instance.new("UICorner", AimFrame).CornerRadius = UDim.new(0, 6)

local AimTitle = Instance.new("TextLabel", AimFrame)
AimTitle.Text = "Aimbot Settings (Exunys V3)"
AimTitle.Size = UDim2.new(1,0,0,25)
AimTitle.BackgroundTransparency = 1
AimTitle.TextColor3 = Theme.Accent
AimTitle.Font = Enum.Font.GothamBlack
AimTitle.TextSize = 14

local AimTogBtn = Instance.new("TextButton", AimFrame)
AimTogBtn.Size = UDim2.new(0, 80, 0, 25)
AimTogBtn.Position = UDim2.new(0.05, 0, 0, 30)
AimTogBtn.Text = "OFF"
AimTogBtn.BackgroundColor3 = Color3.fromRGB(50,50,60)
AimTogBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", AimTogBtn).CornerRadius = UDim.new(0,6)

local aimOn = false
AimTogBtn.MouseButton1Click:Connect(function()
    if not Aimbot.Settings then return end
    aimOn = not aimOn
    AimTogBtn.Text = aimOn and "ON" or "OFF"
    AimTogBtn.BackgroundColor3 = aimOn and Theme.Accent or Color3.fromRGB(50,50,60)
    
    Aimbot.Settings.Enabled = aimOn
    Aimbot.FOVSettings.Visible = aimOn
end)

local ModeBtn = Instance.new("TextButton", AimFrame)
ModeBtn.Size = UDim2.new(0, 140, 0, 25)
ModeBtn.Position = UDim2.new(0.45, 0, 0, 30)
ModeBtn.Text = "MODE: SMOOTH"
ModeBtn.BackgroundColor3 = Color3.fromRGB(60,60,70)
ModeBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", ModeBtn).CornerRadius = UDim.new(0,6)

local isInstant = false
ModeBtn.MouseButton1Click:Connect(function()
    isInstant = not isInstant
    if isInstant then
        ModeBtn.Text = "MODE: INSTANT"
        ModeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        if Aimbot.Settings then Aimbot.Settings.Sensitivity = 0 end
    else
        ModeBtn.Text = "MODE: SMOOTH"
        ModeBtn.BackgroundColor3 = Color3.fromRGB(60,60,70)
        if Aimbot.Settings then Aimbot.Settings.Sensitivity = 0.2 end
    end
end)

local SliderTitle = Instance.new("TextLabel", AimFrame)
SliderTitle.Text = "FOV Radius"
SliderTitle.Size = UDim2.new(0,100,0,20)
SliderTitle.Position = UDim2.new(0.05, 0, 0, 60)
SliderTitle.BackgroundTransparency = 1
SliderTitle.TextColor3 = Theme.Text
SliderTitle.TextXAlignment = 0

local SliderBg = Instance.new("Frame", AimFrame)
SliderBg.Size = UDim2.new(0.9, 0, 0, 6)
SliderBg.Position = UDim2.new(0.05, 0, 0, 85)
SliderBg.BackgroundColor3 = Color3.fromRGB(20,20,20)
Instance.new("UICorner", SliderBg).CornerRadius = UDim.new(1,0)

local SliderFill = Instance.new("Frame", SliderBg)
SliderFill.Size = UDim2.new(0.2, 0, 1, 0)
SliderFill.BackgroundColor3 = Theme.Accent
Instance.new("UICorner", SliderFill).CornerRadius = UDim.new(1,0)

local SliderBtn = Instance.new("TextButton", SliderBg)
SliderBtn.Size = UDim2.new(1,0,1,0)
SliderBtn.BackgroundTransparency = 1
SliderBtn.Text = ""

local sDragging = false
table.insert(AppConnections, SliderBtn.InputBegan:Connect(function(input) 
    if input.UserInputType == Enum.UserInputType.MouseButton1 then sDragging = true end 
end))
table.insert(AppConnections, UserInputService.InputEnded:Connect(function(input) 
    if input.UserInputType == Enum.UserInputType.MouseButton1 then sDragging = false end 
end))
table.insert(AppConnections, RunService.RenderStepped:Connect(function()
    if sDragging and Aimbot and Aimbot.FOVSettings then
        local pos = UserInputService:GetMouseLocation().X
        local relPos = pos - SliderBg.AbsolutePosition.X
        local percent = math.clamp(relPos / SliderBg.AbsoluteSize.X, 0, 1)
        SliderFill.Size = UDim2.new(percent, 0, 1, 0)
        local val = math.floor(percent * 500)
        SliderTitle.Text = "FOV: " .. val
        
        Aimbot.FOVSettings.Radius = val
    end
end))

local KeyBtn = Instance.new("TextButton", AimFrame)
KeyBtn.Size = UDim2.new(0, 120, 0, 25)
KeyBtn.Position = UDim2.new(0.05, 0, 0, 105)
KeyBtn.BackgroundColor3 = Color3.fromRGB(60,60,70)
KeyBtn.Text = "Key: RightMouse"
KeyBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", KeyBtn).CornerRadius = UDim.new(0,6)

local binding = false
KeyBtn.MouseButton1Click:Connect(function()
    KeyBtn.Text = "Press a key..."
    binding = true
end)

table.insert(AppConnections, UserInputService.InputBegan:Connect(function(input)
    if binding then
        if input.UserInputType == Enum.UserInputType.Keyboard or input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.MouseButton2 then
            binding = false
            local keyName = input.KeyCode.Name
            local keyVal = input.KeyCode
            
            if input.UserInputType == Enum.UserInputType.MouseButton1 then 
                keyName = "LeftMouse"; keyVal = Enum.UserInputType.MouseButton1
            elseif input.UserInputType == Enum.UserInputType.MouseButton2 then 
                keyName = "RightMouse"; keyVal = Enum.UserInputType.MouseButton2
            end
            
            KeyBtn.Text = "Key: " .. keyName
            if Aimbot and Aimbot.Settings then Aimbot.Settings.TriggerKey = keyVal end
        end
    end
end))

-- ==========================================
-- ЛОГИКА ОКНА (CLOSE & TOGGLE)
-- ==========================================
function ToggleUI(showMain) 
    if showMain then
        MainFrame.Visible = true; MiniButton.Visible = false
    else
        MainFrame.Visible = false; MiniButton.Visible = true
    end
end

CloseBtn.MouseButton1Click:Connect(function()
    ClickTPEnabled = false
    toggleESP(false)
    if noclipConn then noclipConn:Disconnect(); noclipConn = nil end
    if Aimbot and Aimbot.Exit then Aimbot:Exit() end
    
    local fly = Player.PlayerGui:FindFirstChild("FlyGui") or Player.PlayerGui:FindFirstChild("main")
    if fly then fly.Enabled = false end
    
    -- Очистка памяти (Отключение всех событий)
    for _, conn in pairs(AppConnections) do
        if conn and typeof(conn) == "RBXScriptConnection" then
            conn:Disconnect()
        end
    end
    AppConnections = {}

    ScreenGui:Destroy()
end)

MinBtn.MouseButton1Click:Connect(function() ToggleUI(false) end)

local dragMini, miniDragStart, miniStartPos
local tapStartTime, tapStartPos = 0, Vector2.new(0,0)

table.insert(AppConnections, MiniButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragMini = true
        miniDragStart = input.Position
        miniStartPos = MiniButton.Position
        tapStartTime = tick()
        tapStartPos = Vector2.new(input.Position.X, input.Position.Y)
        input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragMini = false end end)
    end
end))

table.insert(AppConnections, MiniButton.InputChanged:Connect(function(input)
    if dragMini and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - miniDragStart
        MiniButton.Position = UDim2.new(miniStartPos.X.Scale, miniStartPos.X.Offset + delta.X, miniStartPos.Y.Scale, miniStartPos.Y.Offset + delta.Y)
    end
end))

table.insert(AppConnections, MiniButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragMini = false
        local duration = tick() - tapStartTime
        local dist = (Vector2.new(input.Position.X, input.Position.Y) - tapStartPos).Magnitude
        if duration < 0.25 and dist < 10 then ToggleUI(true) end
    end
end))

SwitchTab("Main")